apiVersion: v1
kind: ConfigMap
metadata:
  name: db-recipe-init-scripts
  namespace: postgresql
data:
  01_schema.sql: |
    CREATE DATABASE mealplanner;

    \c mealplanner;

    CREATE TABLE IF NOT EXISTS recipes (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL,
        description TEXT,
        created_at TIMESTAMPTZ DEFAULT NOW(),
        updated_at TIMESTAMPTZ DEFAULT NOW()
    );

    CREATE TABLE IF NOT EXISTS ingredients (
        id SERIAL PRIMARY KEY,
        name TEXT NOT NULL UNIQUE,
        unit TEXT
    );

    CREATE TABLE IF NOT EXISTS recipe_ingredients (
        id SERIAL PRIMARY KEY,
        recipe_id INT REFERENCES recipes(id) ON DELETE CASCADE,
        ingredient_id INT REFERENCES ingredients(id) ON DELETE CASCADE,
        quantity NUMERIC NOT NULL
    );

    CREATE TABLE IF NOT EXISTS mealplans (
        id SERIAL PRIMARY KEY,
        user_id INT,
        week_start DATE NOT NULL,
        created_at TIMESTAMPTZ DEFAULT NOW()
    );

    CREATE TABLE IF NOT EXISTS mealplan_recipes (
        id SERIAL PRIMARY KEY,
        mealplan_id INT REFERENCES mealplans(id) ON DELETE CASCADE,
        recipe_id INT REFERENCES recipes(id) ON DELETE CASCADE,
        day_of_week INT NOT NULL CHECK (day_of_week >= 0 AND day_of_week <= 6)
    );

  02_ingest_data.sql: |
    \c mealplanner;

    -- Ingredients
    INSERT INTO ingredients (name, unit) VALUES
      ('Tomato', 'pcs'),
      ('Pasta', 'grams'),
      ('Chicken Breast', 'grams'),
      ('Olive Oil', 'ml'),
      ('Salt', 'grams'),
      ('Onion', 'pcs'),
      ('Garlic', 'cloves'),
      ('Bell Pepper', 'pcs'),
      ('Beef', 'grams'),
      ('Potato', 'grams'),
      ('Carrot', 'grams'),
      ('Cheese', 'grams'),
      ('Milk', 'ml'),
      ('Egg', 'pcs'),
      ('Flour', 'grams'),
      ('Butter', 'grams'),
      ('Rice', 'grams'),
      ('Cucumber', 'pcs'),
      ('Lettuce', 'pcs'),
      ('Basil', 'grams'),
      ('Oregano', 'grams'),
      ('Thyme', 'grams'),
      ('Chicken Thigh', 'grams'),
      ('Pork', 'grams'),
      ('Fish', 'grams');

    -- Recipes
    INSERT INTO recipes (name, description) VALUES
      ('Tomato Pasta', 'Simple tomato pasta recipe'),
      ('Grilled Chicken', 'Easy grilled chicken'),
      ('Beef Stew', 'Hearty beef stew'),
      ('Chicken Curry', 'Spicy chicken curry'),
      ('Vegetable Stir Fry', 'Quick stir-fried vegetables'),
      ('Omelette', 'Classic egg omelette'),
      ('Mashed Potatoes', 'Creamy mashed potatoes'),
      ('Pancakes', 'Fluffy breakfast pancakes'),
      ('Caesar Salad', 'Fresh salad with chicken'),
      ('Grilled Fish', 'Simple grilled fish with herbs');

    -- Recipe Ingredients
    INSERT INTO recipe_ingredients (recipe_id, ingredient_id, quantity) VALUES
      (1, 1, 3),
      (1, 2, 200),
      (1, 4, 20),
      (1, 5, 5),
      (2, 3, 250),
      (2, 4, 15),
      (2, 5, 5),
      (3, 9, 300),
      (3, 10, 200),
      (3, 11, 100),
      (3, 4, 20),
      (3, 5, 5),
      (4, 3, 200),
      (4, 7, 100),
      (4, 8, 50),
      (4, 4, 15),
      (4, 5, 5),
      (5, 6, 2),
      (5, 7, 100),
      (5, 11, 50),
      (5, 4, 10),
      (6, 14, 2),
      (6, 15, 50),
      (6, 13, 100),
      (7, 10, 300),
      (7, 16, 50),
      (7, 5, 5),
      (8, 15, 100),
      (8, 13, 150),
      (8, 14, 1),
      (9, 24, 200),
      (9, 18, 1),
      (9, 19, 2),
      (9, 4, 15),
      (10, 25, 200),
      (10, 21, 5),
      (10, 22, 3),
      (10, 4, 10);

    -- Mealplans
    INSERT INTO mealplans (user_id, week_start) VALUES
      (1, '2025-12-02'),
      (2, '2025-12-09'),
      (3, '2025-12-16'),
      (4, '2025-12-23'),
      (5, '2025-12-30');

    -- Mealplan Recipes (7 per mealplan, one per day)
    -- Mealplan 1
    INSERT INTO mealplan_recipes (mealplan_id, recipe_id, day_of_week) VALUES
      (1, 1, 0),
      (1, 2, 1),
      (1, 3, 2),
      (1, 4, 3),
      (1, 5, 4),
      (1, 6, 5),
      (1, 7, 6);

    -- Mealplan 2
    INSERT INTO mealplan_recipes (mealplan_id, recipe_id, day_of_week) VALUES
      (2, 2, 0),
      (2, 3, 1),
      (2, 4, 2),
      (2, 5, 3),
      (2, 6, 4),
      (2, 7, 5),
      (2, 8, 6);

    -- Mealplan 3
    INSERT INTO mealplan_recipes (mealplan_id, recipe_id, day_of_week) VALUES
      (3, 3, 0),
      (3, 4, 1),
      (3, 5, 2),
      (3, 6, 3),
      (3, 7, 4),
      (3, 8, 5),
      (3, 9, 6);

    -- Mealplan 4
    INSERT INTO mealplan_recipes (mealplan_id, recipe_id, day_of_week) VALUES
      (4, 4, 0),
      (4, 5, 1),
      (4, 6, 2),
      (4, 7, 3),
      (4, 8, 4),
      (4, 9, 5),
      (4, 10, 6);

    -- Mealplan 5
    INSERT INTO mealplan_recipes (mealplan_id, recipe_id, day_of_week) VALUES
      (5, 5, 0),
      (5, 6, 1),
      (5, 7, 2),
      (5, 8, 3),
      (5, 9, 4),
      (5, 10, 5),
      (5, 1, 6);
